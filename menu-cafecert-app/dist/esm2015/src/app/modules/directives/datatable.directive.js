import * as tslib_1 from "tslib";
import { Directive, ElementRef, Input, Renderer2 } from '@angular/core';
let DatatableDirective = class DatatableDirective {
    constructor(elRef, renderer) {
        this.elRef = elRef;
        this.renderer = renderer;
        this.options = {};
        this.data = [];
        this.rows = [];
        this.listRowSize = [10, 25, 50, 100];
        this.itemsPerPage = this.listRowSize[0];
        this.minRow = 0;
        this.maxRow = this.itemsPerPage;
        this.paginationList = [];
        this.selectedPage = 0;
        this.maxPage = 0;
        this.tableHeight = 0;
        this.minPageShow = 0;
        this.pageLength = 8;
        this.maxPageShow = this.pageLength;
    }
    ngAfterContentInit() {
        let el = this.elRef.nativeElement.children;
        let tBodyT = el[1];
        this.rows = Array.prototype.slice.call(tBodyT.children);
        this.data = this.rows;
    }
    ngAfterViewInit() {
        this.createDataTable();
    }
    createDataTable() {
        this.createTable();
        let parent = this.elRef.nativeElement.parentNode;
        let divElement = this.renderer.createElement("div");
        this.renderer.insertBefore(parent, divElement, this.elRef.nativeElement);
        this.renderer.removeChild(parent, this.elRef.nativeElement);
        this.renderer.appendChild(divElement, this.elRef.nativeElement);
        /* VALIDACIÓN ITEMS POR PÁGINA */
        let validateSelect = false;
        try {
            let selectList = parent.firstChild.firstChild.children;
            if (selectList[1].nodeName == 'SELECT') {
                // Ya existe
                validateSelect = true;
            }
        }
        catch (error) {
        }
        if (validateSelect) {
            this.renderer.removeChild(parent, parent.firstChild);
        }
        this.renderer.insertBefore(divElement, this.createShow(), this.elRef.nativeElement);
        /* VALIDACIÓN PAGINADOR */
        let validateUl = false;
        try {
            let ulList = parent.lastChild.lastChild;
            if (ulList.nodeName == 'UL') {
                // Ya existe
                validateUl = true;
            }
        }
        catch (error) {
        }
        if (validateUl) {
            this.renderer.removeChild(parent, parent.lastChild);
        }
        this.renderer.appendChild(divElement, this.createPaginator());
    }
    createShow() {
        let divPanelShowList = this.renderer.createElement("div");
        this.renderer.addClass(divPanelShowList, 'row');
        let divShowList = this.renderer.createElement("div");
        this.renderer.setStyle(divShowList, 'padding', '20px 0px 10px 50px');
        this.renderer.addClass(divShowList, 'col');
        let labelShow = this.renderer.createElement('label');
        this.renderer.setStyle(labelShow, 'padding-right', '10px');
        let textShow = this.renderer.createText("Mostrar");
        this.renderer.appendChild(labelShow, textShow);
        this.renderer.appendChild(divShowList, labelShow);
        let selectShowList = this.renderer.createElement('select');
        this.renderer.setStyle(selectShowList, 'height', '20px');
        this.listRowSize.forEach(value => {
            let option = this.renderer.createElement('option');
            option.value = String(value);
            if (value == this.itemsPerPage) {
                option.selected = true;
            }
            let textOption = this.renderer.createText(String(value));
            // this.renderer.setValue(option, String(value));
            this.renderer.appendChild(option, textOption);
            this.renderer.appendChild(selectShowList, option);
            // this.renderer.listen(option, 'click', (event) => this.onChangePag(event));
        });
        this.renderer.appendChild(divShowList, selectShowList);
        let labelRegisterShow = this.renderer.createElement('label');
        this.renderer.setStyle(labelRegisterShow, 'padding-left', '10px');
        let textRegisterShow = this.renderer.createText("registros");
        this.renderer.appendChild(labelRegisterShow, textRegisterShow);
        this.renderer.appendChild(divShowList, labelRegisterShow);
        this.renderer.appendChild(divPanelShowList, divShowList);
        this.renderer.listen(selectShowList, 'change', (event) => this.onChangePag(event.target.value));
        return divPanelShowList;
    }
    createTable() {
        let tHeadT = null;
        let tBodyT = null;
        let el = this.elRef.nativeElement.children;
        if (el.length > 0) {
            try {
                tHeadT = el[0];
                tBodyT = el[1];
            }
            catch (error) {
            }
            if (tHeadT != null) {
                this.renderer.addClass(tHeadT, 'table-header');
                this.renderer.addClass(tHeadT, 'text-center');
            }
            let i = 0;
            this.createPagination(this.data);
            let rows = Array.prototype.slice.call(tBodyT.children);
            rows
                .forEach((row) => {
                this.renderer.addClass(row, 'table-row');
                if (i % 2 == 0) {
                    this.renderer.addClass(row, 'pair');
                }
                else {
                    this.renderer.addClass(row, 'odd');
                }
                if (i >= this.minRow && i <= this.maxRow - 1) {
                    this.renderer.setStyle(row, 'display', '');
                }
                else {
                    this.renderer.setStyle(row, 'display', 'none');
                }
                i++;
            });
        }
    }
    createPaginator() {
        /* PAGINATOR CREATION */
        let ulPaginator = this.renderer.createElement('ul');
        this.renderer.addClass(ulPaginator, "pagination");
        if (this.paginationList.length > 0) {
            let liPreviousPaginator = this.renderer.createElement('li');
            this.renderer.addClass(liPreviousPaginator, "page-item");
            this.renderer.addClass(liPreviousPaginator, "text-center");
            if (this.selectedPage === 0) {
                this.renderer.addClass(liPreviousPaginator, 'disabled');
            }
            this.renderer.setStyle(liPreviousPaginator, 'min-width', '45px');
            let aPreviousPaginator = this.renderer.createElement('a');
            this.renderer.addClass(aPreviousPaginator, 'page-link');
            this.renderer.addClass(aPreviousPaginator, 'pagination-pages');
            this.renderer.setStyle(aPreviousPaginator, 'background-color', '#da9292');
            this.renderer.setStyle(aPreviousPaginator, 'border-color', '#881010');
            let textPreviousPaginator = this.renderer.createText('Anterior');
            this.renderer.appendChild(aPreviousPaginator, textPreviousPaginator);
            this.renderer.appendChild(liPreviousPaginator, aPreviousPaginator);
            this.renderer.appendChild(ulPaginator, liPreviousPaginator);
            this.renderer.listen(aPreviousPaginator, 'click', () => this.pagination(this.selectedPage - 1));
            this.paginationList.slice(this.minPageShow, this.maxPageShow).forEach((page) => {
                let liPaginator = this.renderer.createElement('li');
                this.renderer.addClass(liPaginator, "page-item");
                this.renderer.addClass(liPaginator, "text-center");
                this.renderer.setStyle(liPaginator, 'min-width', '45px');
                let aPaginator = this.renderer.createElement('a');
                this.renderer.addClass(aPaginator, 'page-link');
                this.renderer.addClass(aPaginator, 'pagination-pages');
                if (this.selectedPage == page) {
                    this.renderer.addClass(aPaginator, 'active-pagination');
                }
                let textLiPaginator = this.renderer.createText(page + 1);
                this.renderer.appendChild(aPaginator, textLiPaginator);
                this.renderer.appendChild(liPaginator, aPaginator);
                this.renderer.appendChild(ulPaginator, liPaginator);
                this.renderer.listen(aPaginator, 'click', () => this.pagination(page));
            });
            if (this.paginationList.length > this.pageLength &&
                ((this.maxPage - this.maxPageShow) > 0 || this.maxPageShow == this.pageLength)) {
                let liManyPaginator = this.renderer.createElement('li');
                this.renderer.addClass(liManyPaginator, "page-item");
                this.renderer.addClass(liManyPaginator, "text-center");
                this.renderer.setStyle(liManyPaginator, 'min-width', '45px');
                let aManyPaginator = this.renderer.createElement('a');
                this.renderer.addClass(aManyPaginator, 'page-link');
                this.renderer.addClass(aManyPaginator, 'pagination-pages');
                this.renderer.setStyle(aManyPaginator, 'background-color', '#da9292');
                this.renderer.setStyle(aManyPaginator, 'border-color', '#881010');
                let textManyPaginator = this.renderer.createText('...');
                this.renderer.appendChild(aManyPaginator, textManyPaginator);
                this.renderer.appendChild(liManyPaginator, aManyPaginator);
                this.renderer.appendChild(ulPaginator, liManyPaginator);
            }
            let liNextPaginator = this.renderer.createElement('li');
            this.renderer.addClass(liNextPaginator, "page-item");
            this.renderer.addClass(liNextPaginator, "text-center");
            if (this.selectedPage === this.maxPage) {
                this.renderer.addClass(liNextPaginator, 'disabled');
            }
            this.renderer.setStyle(liNextPaginator, 'min-width', '45px');
            let aNextPaginator = this.renderer.createElement('a');
            this.renderer.addClass(aNextPaginator, 'page-link');
            this.renderer.addClass(aNextPaginator, 'pagination-pages');
            this.renderer.setStyle(aNextPaginator, 'background-color', '#da9292');
            this.renderer.setStyle(aNextPaginator, 'border-color', '#881010');
            let textNextPaginator = this.renderer.createText('Siguiente');
            this.renderer.appendChild(aNextPaginator, textNextPaginator);
            this.renderer.appendChild(liNextPaginator, aNextPaginator);
            this.renderer.appendChild(ulPaginator, liNextPaginator);
            this.renderer.listen(aNextPaginator, 'click', () => this.pagination(this.selectedPage + 1));
        }
        let divPaginator = this.renderer.createElement('div');
        this.renderer.addClass(divPaginator, "d-flex");
        this.renderer.addClass(divPaginator, "justify-content-center");
        this.renderer.appendChild(divPaginator, ulPaginator);
        return divPaginator;
    }
    pagination(pag) {
        if (this.paginationList.length > this.pageLength) {
            let maxPerPage = this.pageLength / 2;
            if ((pag + 1 / 2) > (maxPerPage + 1)) {
                if (pag >= (this.maxPage - maxPerPage - 1)) {
                    this.minPageShow = this.maxPage - this.pageLength;
                    this.maxPageShow = this.minPageShow + this.pageLength + 1;
                }
                else {
                    this.minPageShow = pag - maxPerPage;
                    this.maxPageShow = this.minPageShow + this.pageLength;
                }
            }
            else {
                this.minPageShow = 0;
                this.maxPageShow = this.pageLength;
            }
        }
        else {
            this.minPageShow = 0;
            this.maxPageShow = this.pageLength;
        }
        this.minRow = this.itemsPerPage * pag;
        this.maxRow = this.itemsPerPage * (pag + 1);
        this.selectedPage = pag;
        this.createDataTable();
    }
    createPagination(lista) {
        let maxPageSelect = this.listRowSize[this.listRowSize.length - 1];
        for (let i = 0; i <= this.listRowSize.length - 1; i++) {
            if (lista.length >= this.listRowSize[i] && lista.length <= this.listRowSize[i + 1]) {
                maxPageSelect = this.listRowSize[i + 1];
            }
        }
        let x = this.itemsPerPage;
        if (x > maxPageSelect) {
            x = maxPageSelect;
        }
        this.paginationList = [];
        let listaLength = lista.length / x;
        for (let k = 0; k < Math.ceil(listaLength); k++) {
            this.paginationList.push(k);
        }
        this.maxPage = Math.ceil(listaLength) - 1;
    }
    onChangePag(value) {
        this.itemsPerPage = value;
        this.createPagination(this.data);
        this.pagination(0);
    }
};
DatatableDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 }
];
tslib_1.__decorate([
    Input()
], DatatableDirective.prototype, "options", void 0);
tslib_1.__decorate([
    Input()
], DatatableDirective.prototype, "data", void 0);
DatatableDirective = tslib_1.__decorate([
    Directive({
        selector: '[datatable]'
    })
], DatatableDirective);
export { DatatableDirective };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZGF0YXRhYmxlLmRpcmVjdGl2ZS5qcyIsInNvdXJjZVJvb3QiOiJuZzovL21lbnUtY2FmZWNlcnQtYXBwLyIsInNvdXJjZXMiOlsic3JjL2FwcC9tb2R1bGVzL2RpcmVjdGl2ZXMvZGF0YXRhYmxlLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsS0FBSyxFQUFFLFNBQVMsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUt4RSxJQUFhLGtCQUFrQixHQUEvQixNQUFhLGtCQUFrQjtJQW9CN0IsWUFBb0IsS0FBaUIsRUFBVSxRQUFtQjtRQUE5QyxVQUFLLEdBQUwsS0FBSyxDQUFZO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQWxCekQsWUFBTyxHQUFRLEVBQUUsQ0FBQztRQUVsQixTQUFJLEdBQWUsRUFBRSxDQUFDO1FBQy9CLFNBQUksR0FBZSxFQUFFLENBQUM7UUFFZixnQkFBVyxHQUFrQixDQUFDLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQy9DLGlCQUFZLEdBQVcsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzQyxXQUFNLEdBQVcsQ0FBQyxDQUFDO1FBQ25CLFdBQU0sR0FBVyxJQUFJLENBQUMsWUFBWSxDQUFDO1FBQ25DLG1CQUFjLEdBQWtCLEVBQUUsQ0FBQztRQUNuQyxpQkFBWSxHQUFXLENBQUMsQ0FBQztRQUN6QixZQUFPLEdBQVcsQ0FBQyxDQUFDO1FBQ3BCLGdCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBQ3hCLGdCQUFXLEdBQVcsQ0FBQyxDQUFDO1FBQ3hCLGVBQVUsR0FBVyxDQUFDLENBQUM7UUFDdkIsZ0JBQVcsR0FBVyxJQUFJLENBQUMsVUFBVSxDQUFDO0lBSTdDLENBQUM7SUFFRCxrQkFBa0I7UUFDaEIsSUFBSSxFQUFFLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsUUFBUSxDQUFD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cjIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnW2RhdGF0YWJsZV0nXG59KVxuZXhwb3J0IGNsYXNzIERhdGF0YWJsZURpcmVjdGl2ZSB7XG5cbiAgQElucHV0KCkgb3B0aW9uczogYW55ID0ge307XG5cbiAgQElucHV0KCkgZGF0YTogQXJyYXk8YW55PiA9IFtdO1xuICByb3dzOiBBcnJheTxhbnk+ID0gW107XG5cbiAgcHVibGljIGxpc3RSb3dTaXplOiBBcnJheTxudW1iZXI+ID0gWzEwLCAyNSwgNTAsIDEwMF07XG4gIHB1YmxpYyBpdGVtc1BlclBhZ2U6IG51bWJlciA9IHRoaXMubGlzdFJvd1NpemVbMF07XG4gIHB1YmxpYyBtaW5Sb3c6IG51bWJlciA9IDA7XG4gIHB1YmxpYyBtYXhSb3c6IG51bWJlciA9IHRoaXMuaXRlbXNQZXJQYWdlO1xuICBwdWJsaWMgcGFnaW5hdGlvbkxpc3Q6IEFycmF5PG51bWJlcj4gPSBbXTtcbiAgcHVibGljIHNlbGVjdGVkUGFnZTogbnVtYmVyID0gMDtcbiAgcHVibGljIG1heFBhZ2U6IG51bWJlciA9IDA7XG4gIHB1YmxpYyB0YWJsZUhlaWdodDogbnVtYmVyID0gMDtcbiAgcHVibGljIG1pblBhZ2VTaG93OiBudW1iZXIgPSAwO1xuICBwdWJsaWMgcGFnZUxlbmd0aDogbnVtYmVyID0gODtcbiAgcHVibGljIG1heFBhZ2VTaG93OiBudW1iZXIgPSB0aGlzLnBhZ2VMZW5ndGg7XG5cblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIGVsUmVmOiBFbGVtZW50UmVmLCBwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgfVxuXG4gIG5nQWZ0ZXJDb250ZW50SW5pdCgpIHtcbiAgICBsZXQgZWwgPSB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQuY2hpbGRyZW47XG4gICAgbGV0IHRCb2R5VCA9IGVsWzFdO1xuICAgIHRoaXMucm93cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRCb2R5VC5jaGlsZHJlbik7XG4gICAgdGhpcy5kYXRhID0gdGhpcy5yb3dzO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuY3JlYXRlRGF0YVRhYmxlKCk7XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlRGF0YVRhYmxlKCkge1xuICAgIHRoaXMuY3JlYXRlVGFibGUoKTtcbiAgICBsZXQgcGFyZW50ID0gdGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50LnBhcmVudE5vZGU7XG5cbiAgICBsZXQgZGl2RWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnJlbmRlcmVyLmluc2VydEJlZm9yZShwYXJlbnQsIGRpdkVsZW1lbnQsIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDaGlsZChwYXJlbnQsIHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudCk7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChkaXZFbGVtZW50LCB0aGlzLmVsUmVmLm5hdGl2ZUVsZW1lbnQpO1xuXG4gICAgLyogVkFMSURBQ0nDk04gSVRFTVMgUE9SIFDDgUdJTkEgKi9cbiAgICBsZXQgdmFsaWRhdGVTZWxlY3QgPSBmYWxzZTtcbiAgICB0cnkge1xuICAgICAgbGV0IHNlbGVjdExpc3QgPSBwYXJlbnQuZmlyc3RDaGlsZC5maXJzdENoaWxkLmNoaWxkcmVuO1xuXG4gICAgICBpZiAoc2VsZWN0TGlzdFsxXS5ub2RlTmFtZSA9PSAnU0VMRUNUJykge1xuICAgICAgICAvLyBZYSBleGlzdGVcbiAgICAgICAgdmFsaWRhdGVTZWxlY3QgPSB0cnVlO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG5cbiAgICB9XG4gICAgaWYgKHZhbGlkYXRlU2VsZWN0KSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKHBhcmVudCwgcGFyZW50LmZpcnN0Q2hpbGQpO1xuICAgIH1cbiAgICB0aGlzLnJlbmRlcmVyLmluc2VydEJlZm9yZShkaXZFbGVtZW50LCB0aGlzLmNyZWF0ZVNob3coKSwgdGhpcy5lbFJlZi5uYXRpdmVFbGVtZW50KTtcblxuICAgIC8qIFZBTElEQUNJw5NOIFBBR0lOQURPUiAqL1xuICAgIGxldCB2YWxpZGF0ZVVsID0gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIGxldCB1bExpc3QgPSBwYXJlbnQubGFzdENoaWxkLmxhc3RDaGlsZDtcbiAgICAgIGlmICh1bExpc3Qubm9kZU5hbWUgPT0gJ1VMJykge1xuICAgICAgICAvLyBZYSBleGlzdGVcbiAgICAgICAgdmFsaWRhdGVVbCA9IHRydWU7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcblxuICAgIH1cbiAgICBpZiAodmFsaWRhdGVVbCkge1xuICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDaGlsZChwYXJlbnQsIHBhcmVudC5sYXN0Q2hpbGQpO1xuICAgIH1cbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKGRpdkVsZW1lbnQsIHRoaXMuY3JlYXRlUGFnaW5hdG9yKCkpO1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVNob3coKTogYW55IHtcbiAgICBsZXQgZGl2UGFuZWxTaG93TGlzdCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKGRpdlBhbmVsU2hvd0xpc3QsICdyb3cnKTtcblxuICAgIGxldCBkaXZTaG93TGlzdCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGRpdlNob3dMaXN0LCAncGFkZGluZycsICcyMHB4IDBweCAxMHB4IDUwcHgnKTtcbiAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKGRpdlNob3dMaXN0LCAnY29sJyk7XG5cbiAgICBsZXQgbGFiZWxTaG93ID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdsYWJlbCcpO1xuICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUobGFiZWxTaG93LCAncGFkZGluZy1yaWdodCcsICcxMHB4Jyk7XG4gICAgbGV0IHRleHRTaG93ID0gdGhpcy5yZW5kZXJlci5jcmVhdGVUZXh0KFwiTW9zdHJhclwiKTtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQobGFiZWxTaG93LCB0ZXh0U2hvdyk7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChkaXZTaG93TGlzdCwgbGFiZWxTaG93KTtcblxuICAgIGxldCBzZWxlY3RTaG93TGlzdCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnc2VsZWN0Jyk7XG4gICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShzZWxlY3RTaG93TGlzdCwgJ2hlaWdodCcsICcyMHB4Jyk7XG4gICAgdGhpcy5saXN0Um93U2l6ZS5mb3JFYWNoKHZhbHVlID0+IHtcbiAgICAgIGxldCBvcHRpb24gPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xuICAgICAgb3B0aW9uLnZhbHVlID0gU3RyaW5nKHZhbHVlKTtcbiAgICAgIGlmICh2YWx1ZSA9PSB0aGlzLml0ZW1zUGVyUGFnZSkge1xuICAgICAgICBvcHRpb24uc2VsZWN0ZWQgPSB0cnVlO1xuICAgICAgfVxuICAgICAgbGV0IHRleHRPcHRpb24gPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZVRleHQoU3RyaW5nKHZhbHVlKSk7XG4gICAgICAvLyB0aGlzLnJlbmRlcmVyLnNldFZhbHVlKG9wdGlvbiwgU3RyaW5nKHZhbHVlKSk7XG4gICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKG9wdGlvbiwgdGV4dE9wdGlvbik7XG4gICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHNlbGVjdFNob3dMaXN0LCBvcHRpb24pO1xuICAgICAgLy8gdGhpcy5yZW5kZXJlci5saXN0ZW4ob3B0aW9uLCAnY2xpY2snLCAoZXZlbnQpID0+IHRoaXMub25DaGFuZ2VQYWcoZXZlbnQpKTtcbiAgICB9KTtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoZGl2U2hvd0xpc3QsIHNlbGVjdFNob3dMaXN0KTtcblxuICAgIGxldCBsYWJlbFJlZ2lzdGVyU2hvdyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnbGFiZWwnKTtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGxhYmVsUmVnaXN0ZXJTaG93LCAncGFkZGluZy1sZWZ0JywgJzEwcHgnKTtcbiAgICBsZXQgdGV4dFJlZ2lzdGVyU2hvdyA9IHRoaXMucmVuZGVyZXIuY3JlYXRlVGV4dChcInJlZ2lzdHJvc1wiKTtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQobGFiZWxSZWdpc3RlclNob3csIHRleHRSZWdpc3RlclNob3cpO1xuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoZGl2U2hvd0xpc3QsIGxhYmVsUmVnaXN0ZXJTaG93KTtcblxuICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoZGl2UGFuZWxTaG93TGlzdCwgZGl2U2hvd0xpc3QpO1xuICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKHNlbGVjdFNob3dMaXN0LCAnY2hhbmdlJywgKGV2ZW50KSA9PiB0aGlzLm9uQ2hhbmdlUGFnKGV2ZW50LnRhcmdldC52YWx1ZSkpO1xuICAgIHJldHVybiBkaXZQYW5lbFNob3dMaXN0O1xuICB9XG5cbiAgcHVibGljIGNyZWF0ZVRhYmxlKCkge1xuICAgIGxldCB0SGVhZFQgPSBudWxsO1xuICAgIGxldCB0Qm9keVQgPSBudWxsO1xuICAgIGxldCBlbCA9IHRoaXMuZWxSZWYubmF0aXZlRWxlbWVudC5jaGlsZHJlbjtcbiAgICBpZiAoZWwubGVuZ3RoID4gMCkge1xuXG4gICAgICB0cnkge1xuICAgICAgICB0SGVhZFQgPSBlbFswXTtcbiAgICAgICAgdEJvZHlUID0gZWxbMV07XG4gICAgICB9IGNhdGNoIChlcnJvcikge1xuXG4gICAgICB9XG5cbiAgICAgIGlmICh0SGVhZFQgIT0gbnVsbCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRIZWFkVCwgJ3RhYmxlLWhlYWRlcicpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRIZWFkVCwgJ3RleHQtY2VudGVyJyk7XG4gICAgICB9XG5cbiAgICAgIGxldCBpOiBudW1iZXIgPSAwO1xuICAgICAgdGhpcy5jcmVhdGVQYWdpbmF0aW9uKHRoaXMuZGF0YSk7XG4gICAgICBsZXQgcm93cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHRCb2R5VC5jaGlsZHJlbik7XG5cbiAgICAgIHJvd3NcbiAgICAgICAgLmZvckVhY2goKHJvdzogYW55KSA9PiB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhyb3csICd0YWJsZS1yb3cnKTtcbiAgICAgICAgICBpZiAoaSAlIDIgPT0gMCkge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhyb3csICdwYWlyJyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3Mocm93LCAnb2RkJyk7XG4gICAgICAgICAgfVxuXG4gICAgICAgICAgaWYgKGkgPj0gdGhpcy5taW5Sb3cgJiYgaSA8PSB0aGlzLm1heFJvdyAtIDEpIHtcbiAgICAgICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUocm93LCAnZGlzcGxheScsICcnKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShyb3csICdkaXNwbGF5JywgJ25vbmUnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaSsrO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgY3JlYXRlUGFnaW5hdG9yKCk6IGFueSB7XG4gICAgLyogUEFHSU5BVE9SIENSRUFUSU9OICovXG4gICAgbGV0IHVsUGFnaW5hdG9yID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCd1bCcpO1xuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModWxQYWdpbmF0b3IsIFwicGFnaW5hdGlvblwiKTtcblxuICAgIGlmICh0aGlzLnBhZ2luYXRpb25MaXN0Lmxlbmd0aCA+IDApIHtcbiAgICAgIGxldCBsaVByZXZpb3VzUGFnaW5hdG9yID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhsaVByZXZpb3VzUGFnaW5hdG9yLCBcInBhZ2UtaXRlbVwiKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MobGlQcmV2aW91c1BhZ2luYXRvciwgXCJ0ZXh0LWNlbnRlclwiKTtcbiAgICAgIGlmICh0aGlzLnNlbGVjdGVkUGFnZSA9PT0gMCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKGxpUHJldmlvdXNQYWdpbmF0b3IsICdkaXNhYmxlZCcpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShsaVByZXZpb3VzUGFnaW5hdG9yLCAnbWluLXdpZHRoJywgJzQ1cHgnKTtcblxuICAgICAgbGV0IGFQcmV2aW91c1BhZ2luYXRvciA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhhUHJldmlvdXNQYWdpbmF0b3IsICdwYWdlLWxpbmsnKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoYVByZXZpb3VzUGFnaW5hdG9yLCAncGFnaW5hdGlvbi1wYWdlcycpO1xuICAgICAgdGhpcy5yZW5kZXJlci5zZXRTdHlsZShhUHJldmlvdXNQYWdpbmF0b3IsICdiYWNrZ3JvdW5kLWNvbG9yJywgJyNkYTkyOTInKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoYVByZXZpb3VzUGFnaW5hdG9yLCAnYm9yZGVyLWNvbG9yJywgJyM4ODEwMTAnKTtcbiAgICAgIGxldCB0ZXh0UHJldmlvdXNQYWdpbmF0b3IgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZVRleHQoJ0FudGVyaW9yJyk7XG5cbiAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoYVByZXZpb3VzUGFnaW5hdG9yLCB0ZXh0UHJldmlvdXNQYWdpbmF0b3IpO1xuICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChsaVByZXZpb3VzUGFnaW5hdG9yLCBhUHJldmlvdXNQYWdpbmF0b3IpO1xuXG4gICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHVsUGFnaW5hdG9yLCBsaVByZXZpb3VzUGFnaW5hdG9yKTtcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKGFQcmV2aW91c1BhZ2luYXRvciwgJ2NsaWNrJywgKCkgPT4gdGhpcy5wYWdpbmF0aW9uKHRoaXMuc2VsZWN0ZWRQYWdlIC0gMSkpO1xuXG4gICAgICB0aGlzLnBhZ2luYXRpb25MaXN0LnNsaWNlKHRoaXMubWluUGFnZVNob3csIHRoaXMubWF4UGFnZVNob3cpLmZvckVhY2goXG4gICAgICAgIChwYWdlOiBhbnkpID0+IHtcbiAgICAgICAgICBsZXQgbGlQYWdpbmF0b3IgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhsaVBhZ2luYXRvciwgXCJwYWdlLWl0ZW1cIik7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhsaVBhZ2luYXRvciwgXCJ0ZXh0LWNlbnRlclwiKTtcbiAgICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGxpUGFnaW5hdG9yLCAnbWluLXdpZHRoJywgJzQ1cHgnKTtcblxuICAgICAgICAgIGxldCBhUGFnaW5hdG9yID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdhJyk7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhhUGFnaW5hdG9yLCAncGFnZS1saW5rJyk7XG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhhUGFnaW5hdG9yLCAncGFnaW5hdGlvbi1wYWdlcycpO1xuICAgICAgICAgIGlmICh0aGlzLnNlbGVjdGVkUGFnZSA9PSBwYWdlKSB7XG4gICAgICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKGFQYWdpbmF0b3IsICdhY3RpdmUtcGFnaW5hdGlvbicpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsZXQgdGV4dExpUGFnaW5hdG9yID0gdGhpcy5yZW5kZXJlci5jcmVhdGVUZXh0KHBhZ2UgKyAxKTtcblxuICAgICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoYVBhZ2luYXRvciwgdGV4dExpUGFnaW5hdG9yKTtcblxuICAgICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQobGlQYWdpbmF0b3IsIGFQYWdpbmF0b3IpO1xuXG4gICAgICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh1bFBhZ2luYXRvciwgbGlQYWdpbmF0b3IpO1xuICAgICAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKGFQYWdpbmF0b3IsICdjbGljaycsICgpID0+IHRoaXMucGFnaW5hdGlvbihwYWdlKSk7XG4gICAgICAgIH0pO1xuXG4gICAgICBpZiAodGhpcy5wYWdpbmF0aW9uTGlzdC5sZW5ndGggPiB0aGlzLnBhZ2VMZW5ndGggJiYgXG4gICAgICAgICgodGhpcy5tYXhQYWdlIC0gdGhpcy5tYXhQYWdlU2hvdykgPiAwfHwgdGhpcy5tYXhQYWdlU2hvdyA9PSB0aGlzLnBhZ2VMZW5ndGgpKSB7XG4gICAgICAgIGxldCBsaU1hbnlQYWdpbmF0b3IgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MobGlNYW55UGFnaW5hdG9yLCBcInBhZ2UtaXRlbVwiKTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhsaU1hbnlQYWdpbmF0b3IsIFwidGV4dC1jZW50ZXJcIik7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUobGlNYW55UGFnaW5hdG9yLCAnbWluLXdpZHRoJywgJzQ1cHgnKTtcblxuICAgICAgICBsZXQgYU1hbnlQYWdpbmF0b3IgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhhTWFueVBhZ2luYXRvciwgJ3BhZ2UtbGluaycpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKGFNYW55UGFnaW5hdG9yLCAncGFnaW5hdGlvbi1wYWdlcycpO1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGFNYW55UGFnaW5hdG9yLCAnYmFja2dyb3VuZC1jb2xvcicsICcjZGE5MjkyJyk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoYU1hbnlQYWdpbmF0b3IsICdib3JkZXItY29sb3InLCAnIzg4MTAxMCcpO1xuICAgICAgICBsZXQgdGV4dE1hbnlQYWdpbmF0b3IgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZVRleHQoJy4uLicpO1xuXG4gICAgICAgIHRoaXMucmVuZGVyZXIuYXBwZW5kQ2hpbGQoYU1hbnlQYWdpbmF0b3IsIHRleHRNYW55UGFnaW5hdG9yKTtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChsaU1hbnlQYWdpbmF0b3IsIGFNYW55UGFnaW5hdG9yKTtcblxuICAgICAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHVsUGFnaW5hdG9yLCBsaU1hbnlQYWdpbmF0b3IpO1xuICAgICAgfVxuXG4gICAgICBsZXQgbGlOZXh0UGFnaW5hdG9yID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdsaScpO1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhsaU5leHRQYWdpbmF0b3IsIFwicGFnZS1pdGVtXCIpO1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhsaU5leHRQYWdpbmF0b3IsIFwidGV4dC1jZW50ZXJcIik7XG4gICAgICBpZiAodGhpcy5zZWxlY3RlZFBhZ2UgPT09IHRoaXMubWF4UGFnZSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKGxpTmV4dFBhZ2luYXRvciwgJ2Rpc2FibGVkJyk7XG4gICAgICB9XG4gICAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKGxpTmV4dFBhZ2luYXRvciwgJ21pbi13aWR0aCcsICc0NXB4Jyk7XG5cbiAgICAgIGxldCBhTmV4dFBhZ2luYXRvciA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnYScpO1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhhTmV4dFBhZ2luYXRvciwgJ3BhZ2UtbGluaycpO1xuICAgICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhhTmV4dFBhZ2luYXRvciwgJ3BhZ2luYXRpb24tcGFnZXMnKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoYU5leHRQYWdpbmF0b3IsICdiYWNrZ3JvdW5kLWNvbG9yJywgJyNkYTkyOTInKTtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoYU5leHRQYWdpbmF0b3IsICdib3JkZXItY29sb3InLCAnIzg4MTAxMCcpO1xuICAgICAgbGV0IHRleHROZXh0UGFnaW5hdG9yID0gdGhpcy5yZW5kZXJlci5jcmVhdGVUZXh0KCdTaWd1aWVudGUnKTtcblxuICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChhTmV4dFBhZ2luYXRvciwgdGV4dE5leHRQYWdpbmF0b3IpO1xuICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChsaU5leHRQYWdpbmF0b3IsIGFOZXh0UGFnaW5hdG9yKTtcblxuICAgICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh1bFBhZ2luYXRvciwgbGlOZXh0UGFnaW5hdG9yKTtcbiAgICAgIHRoaXMucmVuZGVyZXIubGlzdGVuKGFOZXh0UGFnaW5hdG9yLCAnY2xpY2snLCAoKSA9PiB0aGlzLnBhZ2luYXRpb24odGhpcy5zZWxlY3RlZFBhZ2UgKyAxKSk7XG4gICAgfVxuXG4gICAgbGV0IGRpdlBhZ2luYXRvciA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGhpcy5yZW5kZXJlci5hZGRDbGFzcyhkaXZQYWdpbmF0b3IsIFwiZC1mbGV4XCIpO1xuICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3MoZGl2UGFnaW5hdG9yLCBcImp1c3RpZnktY29udGVudC1jZW50ZXJcIik7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZChkaXZQYWdpbmF0b3IsIHVsUGFnaW5hdG9yKTtcbiAgICByZXR1cm4gZGl2UGFnaW5hdG9yO1xuICB9XG5cbiAgcHVibGljIHBhZ2luYXRpb24ocGFnOiBudW1iZXIpIHtcbiAgICBpZiAodGhpcy5wYWdpbmF0aW9uTGlzdC5sZW5ndGggPiB0aGlzLnBhZ2VMZW5ndGgpIHtcbiAgICAgIGxldCBtYXhQZXJQYWdlID0gdGhpcy5wYWdlTGVuZ3RoIC8gMjtcbiAgICAgIGlmICgocGFnICsgMSAvIDIpID4gKG1heFBlclBhZ2UgKyAxKSkge1xuICAgICAgICBpZiAocGFnID49ICh0aGlzLm1heFBhZ2UgLSBtYXhQZXJQYWdlIC0gMSkpIHtcbiAgICAgICAgICB0aGlzLm1pblBhZ2VTaG93ID0gdGhpcy5tYXhQYWdlIC0gdGhpcy5wYWdlTGVuZ3RoO1xuICAgICAgICAgIHRoaXMubWF4UGFnZVNob3cgPSB0aGlzLm1pblBhZ2VTaG93ICsgdGhpcy5wYWdlTGVuZ3RoICsgMTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICB0aGlzLm1pblBhZ2VTaG93ID0gcGFnIC0gbWF4UGVyUGFnZTtcbiAgICAgICAgICB0aGlzLm1heFBhZ2VTaG93ID0gdGhpcy5taW5QYWdlU2hvdyArIHRoaXMucGFnZUxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5taW5QYWdlU2hvdyA9IDA7XG4gICAgICAgIHRoaXMubWF4UGFnZVNob3cgPSB0aGlzLnBhZ2VMZW5ndGg7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMubWluUGFnZVNob3cgPSAwO1xuICAgICAgdGhpcy5tYXhQYWdlU2hvdyA9IHRoaXMucGFnZUxlbmd0aDtcbiAgICB9XG5cbiAgICB0aGlzLm1pblJvdyA9IHRoaXMuaXRlbXNQZXJQYWdlICogcGFnO1xuICAgIHRoaXMubWF4Um93ID0gdGhpcy5pdGVtc1BlclBhZ2UgKiAocGFnICsgMSk7XG4gICAgdGhpcy5zZWxlY3RlZFBhZ2UgPSBwYWc7XG4gICAgdGhpcy5jcmVhdGVEYXRhVGFibGUoKTtcbiAgfVxuXG4gIHB1YmxpYyBjcmVhdGVQYWdpbmF0aW9uKGxpc3RhOiBBcnJheTxhbnk+KSB7XG4gICAgbGV0IG1heFBhZ2VTZWxlY3QgPSB0aGlzLmxpc3RSb3dTaXplW3RoaXMubGlzdFJvd1NpemUubGVuZ3RoIC0gMV07XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPD0gdGhpcy5saXN0Um93U2l6ZS5sZW5ndGggLSAxOyBpKyspIHtcbiAgICAgIGlmIChsaXN0YS5sZW5ndGggPj0gdGhpcy5saXN0Um93U2l6ZVtpXSAmJiBsaXN0YS5sZW5ndGggPD0gdGhpcy5saXN0Um93U2l6ZVtpICsgMV0pIHtcbiAgICAgICAgbWF4UGFnZVNlbGVjdCA9IHRoaXMubGlzdFJvd1NpemVbaSArIDFdO1xuICAgICAgfVxuICAgIH1cbiAgICBsZXQgeCA9IHRoaXMuaXRlbXNQZXJQYWdlO1xuICAgIGlmICh4ID4gbWF4UGFnZVNlbGVjdCkge1xuICAgICAgeCA9IG1heFBhZ2VTZWxlY3Q7XG4gICAgfVxuXG4gICAgdGhpcy5wYWdpbmF0aW9uTGlzdCA9IFtdO1xuICAgIGxldCBsaXN0YUxlbmd0aCA9IGxpc3RhLmxlbmd0aCAvIHg7XG4gICAgZm9yIChsZXQgayA9IDA7IGsgPCBNYXRoLmNlaWwobGlzdGFMZW5ndGgpOyBrKyspIHtcbiAgICAgIHRoaXMucGFnaW5hdGlvbkxpc3QucHVzaChrKTtcbiAgICB9XG4gICAgdGhpcy5tYXhQYWdlID0gTWF0aC5jZWlsKGxpc3RhTGVuZ3RoKSAtIDE7XG5cbiAgfVxuXG4gIHB1YmxpYyBvbkNoYW5nZVBhZyh2YWx1ZTogbnVtYmVyKSB7XG4gICAgdGhpcy5pdGVtc1BlclBhZ2UgPSB2YWx1ZTtcbiAgICB0aGlzLmNyZWF0ZVBhZ2luYXRpb24odGhpcy5kYXRhKTtcbiAgICB0aGlzLnBhZ2luYXRpb24oMCk7XG4gIH1cbn1cbiJdfQ==